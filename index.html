<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIVL 100 - Statics Tutorial Registration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 20px;
        }

        .capacity-tracker {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .capacity-tracker h3 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 18px;
        }

        .session-counts {
            margin-top: 12px;
            font-size: 14px;
        }

        .session-count-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .session-count-item:last-child {
            border-bottom: none;
        }

        .session-info {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .session-info h3 {
            margin-bottom: 12px;
            color: #2c3e50;
            font-size: 16px;
        }

        .session-option {
            margin-bottom: 12px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            font-size: 14px;
        }

        .session-option strong {
            color: #667eea;
            display: block;
            margin-bottom: 4px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 15px;
        }

        .required {
            color: #e74c3c;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 14px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            background: white;
        }

        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        select {
            cursor: pointer;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            touch-action: manipulation;
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            font-size: 15px;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .registrations-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .registrations-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .admin-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .admin-btn {
            flex: 1;
            min-width: 140px;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
        }

        .export-btn {
            background: #28a745;
            color: white;
        }

        .reset-btn {
            background: #dc3545;
            color: white;
        }

        .registrations-table {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 550px;
            font-size: 14px;
        }

        th, td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            color: #2c3e50;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .locked-message {
            text-align: center;
            padding: 40px 20px;
            color: #721c24;
        }

        .locked-message h2 {
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .admin-buttons {
                flex-direction: column;
            }

            .admin-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö CIVL 100 - Statics Tutorial Registration</h1>
            <p>Australian University of Kuwait</p>
        </div>

        <div class="content">
            <div class="capacity-tracker">
                <h3>Registration Capacity</h3>
                <p><strong>Total:</strong> <span id="totalCount">0</span> / 90 students</p>
                <div class="session-counts">
                    <div class="session-count-item">
                        <span>Session 1 (Mon 11 AM)</span>
                        <strong id="count1">0/30</strong>
                    </div>
                    <div class="session-count-item">
                        <span>Session 2 (Mon 4 PM)</span>
                        <strong id="count2">0/30</strong>
                    </div>
                    <div class="session-count-item">
                        <span>Session 3 (Tue 12 PM)</span>
                        <strong id="count3">0/30</strong>
                    </div>
                </div>
            </div>

            <div class="alert" id="alertBox"></div>

            <div id="formSection">
                <div class="session-info">
                    <h3>üìÖ Available Tutorial Sessions</h3>
                    <div class="session-option">
                        <strong>Session 1</strong>
                        Monday, November 24, 2025 | 11:00 AM - 1:00 PM<br>
                        üìç Building 4, Room SF 05
                    </div>
                    <div class="session-option">
                        <strong>Session 2</strong>
                        Monday, November 24, 2025 | 4:00 PM - 6:00 PM<br>
                        üìç Building 1, Room FF 16
                    </div>
                    <div class="session-option">
                        <strong>Session 3</strong>
                        Tuesday, November 25, 2025 | 12:00 PM - 2:00 PM<br>
                        üìç Building 3B, Room GF 02
                    </div>
                </div>

                <div class="form-group">
                    <label for="studentName">Full Name <span class="required">*</span></label>
                    <input type="text" id="studentName" placeholder="Enter your full name">
                </div>

                <div class="form-group">
                    <label for="studentId">Student ID <span class="required">*</span></label>
                    <input type="text" id="studentId" placeholder="Enter your student ID">
                </div>

                <div class="form-group">
                    <label for="sessionSelect">Preferred Session <span class="required">*</span></label>
                    <select id="sessionSelect">
                        <option value="">-- Select a session --</option>
                        <option value="Session1">Session 1 - Mon, Nov 24 | 11 AM - 1 PM | Bldg 4, SF 05</option>
                        <option value="Session2">Session 2 - Mon, Nov 24 | 4 PM - 6 PM | Bldg 1, FF 16</option>
                        <option value="Session3">Session 3 - Tue, Nov 25 | 12 PM - 2 PM | Bldg 3B, GF 02</option>
                    </select>
                </div>

                <button class="submit-btn" id="registerBtn">Register for Tutorial</button>
            </div>

            <div id="lockedSection" style="display: none;">
                <div class="locked-message">
                    <h2>üîí Registration Closed</h2>
                    <p>All tutorial sessions have reached maximum capacity.</p>
                    <p>Please contact Dr. Eyad for assistance.</p>
                </div>
            </div>

            <div class="registrations-section">
                <h3>üìä Registration Records</h3>
                <div class="admin-buttons">
                    <button class="admin-btn export-btn" id="exportBtn">üì• Export CSV</button>
                    <button class="admin-btn reset-btn" id="resetBtn">üîÑ Reset All</button>
                </div>
                <div class="registrations-table">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Name</th>
                                <th>Student ID</th>
                                <th>Session</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td colspan="5" style="text-align: center; color: #999;">No registrations yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

<script>
    // üëâ PUT YOUR WEB APP URL HERE
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyjP6WymcUtJSyeXoB03ArieXLYZFukH8fJ6HoHUyYEt21cgIF3Pt2RQc5_au_VNyVH/exec";

    const MAX_PER_SESSION = 30;

    // Display labels for each session
    const sessions = {
        Session1: 'Mon, Nov 24 | 11 AM - 1 PM | Bldg 4, SF 05',
        Session2: 'Mon, Nov 24 | 4 PM - 6 PM | Bldg 1, FF 16',
        Session3: 'Tue, Nov 25 | 12 PM - 2 PM | Bldg 3B, GF 02'
    };

    // Data coming from Google Sheets
    let registrations = [];
    let counts = {
        Session1: 0,
        Session2: 0,
        Session3: 0
    };

    // Load data from Google Sheets (GET)
    async function fetchData() {
        try {
            const response = await fetch(SCRIPT_URL);
            const json = await response.json();

            registrations = json.registrations || [];
            counts = json.counts || counts;

            updateUI();
        } catch (e) {
            console.error('Error loading data from Google Sheets:', e);
        }
    }

    // Update page UI based on current data
    function updateUI() {
        // Total count
        document.getElementById('totalCount').textContent = registrations.length;

        // Per-session counts
        document.getElementById('count1').textContent = (counts.Session1 || 0) + '/30';
        document.getElementById('count2').textContent = (counts.Session2 || 0) + '/30';
        document.getElementById('count3').textContent = (counts.Session3 || 0) + '/30';

        // Table of registrations
        const tbody = document.getElementById('tableBody');
        if (registrations.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">No registrations yet</td></tr>';
        } else {
            tbody.innerHTML = registrations.map((r, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${r.name}</td>
                    <td>${r.studentId}</td>
                    <td>${sessions[r.session] || r.session}</td>
                    <td>${r.time}</td>
                </tr>
            `).join('');
        }

        // Update dropdown seat availability
        const s1Full = (counts.Session1 || 0) >= MAX_PER_SESSION;
        const s2Full = (counts.Session2 || 0) >= MAX_PER_SESSION;
        const s3Full = (counts.Session3 || 0) >= MAX_PER_SESSION;

        const select = document.getElementById('sessionSelect');
        // Index 0 is "-- Select a session --"
        if (select.options.length >= 4) {
            select.options[1].disabled = s1Full;
            select.options[2].disabled = s2Full;
            select.options[3].disabled = s3Full;

            select.options[1].text = s1Full
                ? 'Session 1 - FULL'
                : 'Session 1 - ' + sessions.Session1;
            select.options[2].text = s2Full
                ? 'Session 2 - FULL'
                : 'Session 2 - ' + sessions.Session2;
            select.options[3].text = s3Full
                ? 'Session 3 - FULL'
                : 'Session 3 - ' + sessions.Session3;
        }

        // Lock form if all sessions are full
        if (s1Full && s2Full && s3Full) {
            document.getElementById('formSection').style.display = 'none';
            document.getElementById('lockedSection').style.display = 'block';
        } else {
            document.getElementById('formSection').style.display = 'block';
            document.getElementById('lockedSection').style.display = 'none';
        }
    }

    // Show alert box
    function showMsg(msg, type) {
        const alert = document.getElementById('alertBox');
        alert.textContent = msg;
        alert.className = 'alert ' + type;
        alert.style.display = 'block';
        setTimeout(() => alert.style.display = 'none', 5000);
    }

    // Handle registration button click
    document.getElementById('registerBtn').addEventListener('click', async function (e) {
        e.preventDefault();

        const name = document.getElementById('studentName').value.trim();
        const studentId = document.getElementById('studentId').value.trim();
        const session = document.getElementById('sessionSelect').value;

        if (!name) {
            showMsg('Please enter your name', 'error');
            return;
        }
        if (!studentId) {
            showMsg('Please enter your Student ID', 'error');
            return;
        }
        if (!session) {
            showMsg('Please select a session', 'error');
            return;
        }

        // Refresh from Google Sheets to avoid stale counts
        await fetchData();

        // Check duplicate student ID
        if (registrations.some(r => r.studentId === studentId)) {
            showMsg('This Student ID is already registered!', 'error');
            return;
        }

        // Check seat limit for this session
        if ((counts[session] || 0) >= MAX_PER_SESSION) {
            showMsg('This session is full! Please choose another.', 'error');
            return;
        }

        const payload = {
            name: name,
            studentId: studentId,
            session: session,                      // "Session1", "Session2", "Session3"
            sessionTime: sessions[session] || ''   // for the sheet
        };

        try {
            await fetch(SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            });

            showMsg('‚úÖ Registration successful!', 'success');
            document.getElementById('studentName').value = '';
            document.getElementById('studentId').value = '';
            document.getElementById('sessionSelect').value = '';

            // Reload data from Google Sheets (new student appears + counts update)
            setTimeout(fetchData, 800);

        } catch (error) {
            console.error('Error submitting registration:', error);
            showMsg('Error submitting registration. Please try again.', 'error');
        }
    });

    // Admin buttons (simplified for Google Sheets backend)

    // Export button ‚Äì tell you to export directly from Google Sheets
    document.getElementById('exportBtn').addEventListener('click', function () {
        alert('All registrations are stored in your Google Sheet.\n\nTo export, open the Sheet and use:\nFile ‚Üí Download ‚Üí Comma Separated Values (.csv)');
    });

    // Reset button ‚Äì tell you to clear the sheet directly
    document.getElementById('resetBtn').addEventListener('click', function () {
        alert('To reset all registrations, open the Google Sheet and delete the data rows (keep the header row).');
    });

    // Load data when the page first opens
    fetchData();
</script>   
</body>
</html>
